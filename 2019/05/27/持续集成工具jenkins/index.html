<!DOCTYPE HTML>
<html lang>

<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="ZKang&#39;s Home">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="http://yoursite.com">
    <!--SEO-->

<meta name="keywords" content>


<meta name="description" content="程序员开发应用，开发后需要提交svn，然后从svn拉取代码，进行构建，发布到tomcat中，发布，然后看呈现效果，这样的工作是频繁反复的在进行的，浪费了程序员的大量时间，那么能不能把这些工作自动...">


<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->

<title>
    
    ZKang&#39;s Home
</title>

<link rel="alternate" href="/atom.xml" title="ZKang&#39;s Home" type="application/atom+xml">


<link rel="icon" href="/favicon.ico">

    

<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.7.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">
    
<div class="hide">
    <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script>
</div>




    

</head></html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header"  style="background-image:url(
    /img/banner.jpg)"
     >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='ZeKang'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
            <!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
            <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
        </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                        <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://yoursite.com">
                        ZKang&#39;s Home</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                        <li role="presentation" class="text-center">
                            <a href="/"><i class="fa "></i>
                                Home</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="">
            
            NO Title!
            
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2019/05/27</span>
    </span>
    
    
</div>
        
        
    </div>
    
    <div class="post-body post-content">
        <p>程序员开发应用，开发后需要提交svn，然后从svn拉取代码，进行构建，发布到tomcat中，发布，然后看呈现效果，这样的工作是频繁反复的在进行的，浪费了程序员的大量时间，那么能不能把这些工作自动化呢，只需要程序员更新代码到svn，然后自动的构建，发布，呈现效果，当然是可以的，通过jenkins来实现。</p>
<h2 id="什么是持续集成"><a href="#什么是持续集成" class="headerlink" title="什么是持续集成"></a>什么是持续集成</h2><p>互联网软件的开发和发布，已经形成了一套标准流程，最重要的组成部分就是持续集成（Continuous integration，简称CI）。<br>持续集成指的是，频繁地（一天多次）将代码集成到主干。<br>它的好处主要有两个。<br>（1）快速发现错误。每完成一点更新，就集成到主干，可以快速发现错误，定位错误也比较容易。<br>（2）防止分支大幅偏离主干。如果不是经常集成，主干又在不断更新，会导致以后集成的难度变大，甚至难以集成。<br>持续集成的目的，就是让产品可以快速迭代，同时还能保持高质量。它的核心措施是，代码集成到主干之前，必须通过自动化测试。只要有一个测试用例失败，就不能集成。</p>
<p>这种做法的核心思想在于：既然事实上难以做到事先完全了解完整的、正确的需求，那么就干脆一小块一小块的做，并且加快交付的速度和频率，使得交付物尽早在下个环节得到验证。早发现问题早返工。</p>
<p><strong>持续集成</strong><br><img src="https://images-cdn.shimo.im/737vd8eXqlQXQ34d/image.png!thumbnail" alt="图片"><br>持续集成强调开发人员提交了新代码之后，立刻进行构建、（单元）测试。根据测试结果，我们可以确定新代码和原有代码能否正确地集成在一起。<br><strong>持续交付</strong><br><img src="https://images-cdn.shimo.im/YmelRpypaccvrMrH/image.png!thumbnail" alt="图片"><br>持续交付在持续集成的基础上，将集成后的代码部署到更贴近真实运行环境的「类生产环境」（<em>production-like environments</em>）中。比如，我们完成单元测试后，可以把代码部署到连接数据库的 Staging 环境中更多的测试。如果代码没有问题，可以继续手动部署到生产环境中。<br><strong>持续部署</strong><br><img src="https://images-cdn.shimo.im/3b6FqXOzKrcVwbeI/image.png!thumbnail" alt="图片"><br>持续部署则是在持续交付的基础上，把部署到生产环境的过程自动化。</p>
<h3 id="总结就是"><a href="#总结就是" class="headerlink" title="总结就是"></a>总结就是</h3><p><strong>持续</strong>，就是说每完成一个完整的部分，就向下个环节交付，发现问题可以马上调整。是的问题不会放大到其他部分和后面的环节。<br><strong>集成，</strong>是指软件个人研发的部分向软件整体部分交付，以便尽早发现个人开发部分的问题；<br><strong>部署，</strong>是代码尽快向可运行的开发/测试节交付，以便尽早测试；<br><strong>交付，</strong>是指研发尽快向客户交付，以便尽早发现生产环境中存在的问题。</p>
<p>1）核心价值体现在：<br>a、持续集成中的任何一个环节都是自动完成的，无需太多的人工干预，有利于减少重复过程以节省时间、费用和工作量；<br>b、持续集成保障了每个时间点上团队成员提交的代码是能成功集成的。换言之，任何时间点都能第一时间发现软件的集成问题，使任意时间发布可部署的软件成为了可能；<br>c、持续集成还能利于软件本身的发展趋势，这点在需求不明确或是频繁性变更的情景中尤其重要，持续集成的质量能帮助团队进行有效决策，同时建立团队对开发产品的信心。</p>
<p>2）持续集成系统的组成<br>由此可见，一个完整的构建系统必须包括：<br>A、一个自动构建过程，包括自动编译、分发、部署和测试等。<br>B、 一个代码存储库，即需要版本控制软件来保障代码的可维护性，同时作为构建过程的素材库。<br>C、一个持续集成服务器。本文中介绍的 Jenkins/Jenkins 就是一个配置简单和使用方便的持续集成服务器。</p>
<h2 id="什么是jenkins"><a href="#什么是jenkins" class="headerlink" title="什么是jenkins"></a>什么是jenkins</h2><p>Jenkins是一个开源的持续集成的服务器，Jenkins开源帮助我们自动构建各类项目。Jenkins强大的插件式，使得Jenkins可以集成很多软件，可能帮助我们持续集成我们的工程项目。</p>
<p>Jenkins对于maven工程完整的编译和发布流程如下：<br>1、Jenkins从SVN上拉取代码到指定的编译机器上。<br>2、在编译机器上触发编译命令或脚本。<br>3、编译得到的结果文件。<br>4、把结果文件传到指定的服务器上。<br>5、重启服务</p>
<h2 id="jenkins环境安装"><a href="#jenkins环境安装" class="headerlink" title="jenkins环境安装"></a>jenkins环境安装</h2><p>【如果都会安装可以跳过，仅供参考】</p>
<h3 id="首先安装java环境"><a href="#首先安装java环境" class="headerlink" title="首先安装java环境"></a>首先安装java环境</h3><p>1、本地下载<strong>jdk8.tar.gz</strong>包，然后通过xshell和xftp工具上传到<strong>/opt</strong>【可自定义】目录。<br>2、使用<strong>tar -zxvf jdk8.tar.gz </strong>解压文件。<br>3、打开<strong>/etc/profile</strong>文件中配置java环境<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/opt/jdk1.8.0_161</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib</span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</span><br></pre></td></tr></table></figure></p>
<p>使用命令<strong>source /etc/profile </strong>让环境重新加载，输入<strong>java -version</strong>坚持是否配置成功<br><img src="https://images-cdn.shimo.im/YBpMwlwsPOsXbsgX/image.png!thumbnail" alt="图片"></p>
<h3 id="安装maven环境"><a href="#安装maven环境" class="headerlink" title="安装maven环境"></a>安装maven环境</h3><p>1、查看地址<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://maven.apache.org/download.cgi</span><br></pre></td></tr></table></figure></p>
<p>2、复制要下载的链接地址，使用linux的wget命令下载。切换到<strong>/opt</strong>目录，直接下载：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.hust.edu.cn/apache/maven/maven-3/3.5.3/binaries/apache-maven-3.5.3-bin.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>3、使用<strong>tar -zxvf apache-maven-3.5.3-bin.tar.gz </strong>解压文件得到<strong>apache-maven-3.5.3</strong><br>4、<strong>/etc/profile</strong>配置环境，并使用命令<strong>source /etc/profile </strong>让环境重新加载<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export MAVEN_HOME=/opt/apache-maven-3.5.3</span><br><span class="line">export PATH=$&#123;MAVEN_HOME&#125;/bin:$PATH</span><br></pre></td></tr></table></figure></p>
<p>5、检验是否配置成功。<br><img src="https://images-cdn.shimo.im/p63TOsQeH8Y1mEhs/image.png!thumbnail" alt="图片"><br>maven的配置setting.xml最好修改镜像源：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;mirror&gt;  </span><br><span class="line">   &lt;id&gt;alimaven&lt;/id&gt;  </span><br><span class="line">   &lt;name&gt;aliyun maven&lt;/name&gt;  </span><br><span class="line">   &lt;url&gt;http:<span class="comment">//maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;  </span></span><br><span class="line">   &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;          </span><br><span class="line"> &lt;/mirror&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="安装git环境"><a href="#安装git环境" class="headerlink" title="安装git环境"></a>安装git环境</h3><p>按照以下命令安装：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel gcc perl-ExtUtils-MakeMaker</span><br><span class="line"></span><br><span class="line">wget https://www.kernel.org/pub/software/scm/git/git-1.8.3.1.tar.gz</span><br><span class="line"></span><br><span class="line">tar xzf git-1.8.3.1.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> git-1.8.3.1</span><br><span class="line">make prefix=/usr/<span class="built_in">local</span>/git all</span><br><span class="line">make prefix=/usr/<span class="built_in">local</span>/git install</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"export PATH=<span class="variable">$PATH</span>:/usr/local/git/bin"</span> &gt;&gt;/etc/bashrc</span><br><span class="line"><span class="built_in">source</span> /etc/bashrc</span><br><span class="line">git --version</span><br></pre></td></tr></table></figure></p>
<p>### </p>
<h2 id="安装jenkins"><a href="#安装jenkins" class="headerlink" title="安装jenkins"></a>安装jenkins</h2><h3 id="下载jenkins-war"><a href="#下载jenkins-war" class="headerlink" title="下载jenkins.war"></a>下载jenkins.war</h3><p>直接下载war包，windows和linux环境通用。linux可以通过wget命令直接下载到指定目录。windows直接把链接复制到浏览器链接栏即可下载。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp-chi.osuosl.org/pub/jenkins/war-stable/2.164.1/jenkins.war</span><br></pre></td></tr></table></figure></p>
<p>下载完了之后可以在当前目录看到jenkins.war包，表示已经下载完成。</p>
<h3 id="运行命令"><a href="#运行命令" class="headerlink" title="运行命令"></a>运行命令</h3><p>jenkins.war包可以有两种运行方式：</p>
<ul>
<li>第一种是把war包放到tomcat的webapps目录下运行；</li>
<li>第二种是直接通过java -jar来启动项目，因为jenkins.war包里面已经内置了jetty服务器，可以直接启动，通过–httpPort来指定启动端口，添加&amp;表示以服务形式启动。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup java -jar jenkins.war --httpPort=8081 &amp;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h3><p>打开链接地址<a href="http://你的ip" target="_blank" rel="noopener">http://你的ip</a>:8081,<br><img src="https://images-cdn.shimo.im/NO68eFVOhVAZIDnm/image.png!thumbnail" alt="图片"><br>获取秘钥：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/.jenkins/secrets/initialAdminPassword</span><br></pre></td></tr></table></figure></p>
<p>新手最好直接选择安装推荐的插件就可以，熟悉以后下次就可以自定义插件安装即可。<br><img src="https://images-cdn.shimo.im/vgryHTJFXaYceKDu/image.png!thumbnail" alt="图片"><br>正在下载推荐的额插件<br><img src="https://images-cdn.shimo.im/v9HGSdXQtWIefB2H/image.png!thumbnail" alt="图片"><br>插件安装完毕，跳转到创建管理员。填入用户名密码。<br><img src="https://images-cdn.shimo.im/ilnAHgiUfLw9EtjT/image.png!thumbnail" alt="图片"><br>随便建个账号密码：admin/admin</p>
<p><img src="https://images-cdn.shimo.im/CAe28rIy690lalvh/image.png!thumbnail" alt="图片"><br>jenkins安装成功。<br><img src="https://images-cdn.shimo.im/FiW7CM9XlaIgvpaF/image.png!thumbnail" alt="图片"></p>
<p>###<br>如果有bug， 就重新启动一下jenkins，用刚才创建的用户重新登录。</p>
<p><strong>设置中文</strong><br>安装插件 Locale plugin</p>
<blockquote>
<p>在可选插件中搜索Locale plugin，我已经安装好了，所以没搜索到。</p>
</blockquote>
<p>在 系统管理 - 系统设置 - Locale 为zh_CN<br>记得打钩！！！！</p>
<p>### </p>
<h3 id="jenkins插件管理"><a href="#jenkins插件管理" class="headerlink" title="jenkins插件管理"></a>jenkins插件管理</h3><p>打开管理插件页面：<br><img src="https://images-cdn.shimo.im/IwxBZQ8YGN82fCrg/image.png!thumbnail" alt="图片"></p>
<ul>
<li>一个构建maven项目插件</li>
</ul>
<p><img src="https://images-cdn.shimo.im/3CEjJga1gjcodKoq/image.png!thumbnail" alt="图片"></p>
<ul>
<li>一个发布到tomcat的插件</li>
</ul>
<p><img src="https://images-cdn.shimo.im/Adnn9dv6Amoall7F/image.png!thumbnail" alt="图片"></p>
<p>选择，直接安装！</p>
<h3 id="jenkins全局配置"><a href="#jenkins全局配置" class="headerlink" title="jenkins全局配置"></a>jenkins全局配置</h3><p>系统管理–》全局工具配置，需要把服务器的jdk、maven、git等环境配置好。</p>
<p><img src="https://images-cdn.shimo.im/9wN9RLhN7mwldckM/image.png!thumbnail" alt="图片"><br><img src="https://uploader.shimo.im/f/pATMkwDRwrMZ2F4Y.png!thumbnail" alt="图片"></p>
<p><img src="https://uploader.shimo.im/f/FVWGNFkXvogRYFzs.png!thumbnail" alt="图片"></p>
<p><img src="https://uploader.shimo.im/f/ey3EuaXrTkIa94B6.png!thumbnail" alt="图片"><br><img src="https://uploader.shimo.im/f/qqYFvvBTLGotb6fn.png!thumbnail" alt="图片"></p>
<p>配置好后记得点应用和保存！！！！</p>
<p>## </p>
<h2 id="构建jar项目"><a href="#构建jar项目" class="headerlink" title="构建jar项目"></a>构建jar项目</h2><h3 id="共同配置"><a href="#共同配置" class="headerlink" title="共同配置"></a>共同配置</h3><ul>
<li>新建一个maven项目。</li>
</ul>
<p><img src="https://uploader.shimo.im/f/ReTvH4wYbrUuRtYd.png!thumbnail" alt="图片"></p>
<ul>
<li>配置git或者svn地址，jenkins会自动从远程仓库拉去最新代码。</li>
</ul>
<p><img src="https://images-cdn.shimo.im/bDKekdg9XZck8i7e/image.png!thumbnail" alt="图片"><br>如果是私有项目的话，需要加入用户名密码<br><img src="https://uploader.shimo.im/f/ouMmi64z4BwOBHnQ.png!thumbnail" alt="图片"><br><img src="https://images-cdn.shimo.im/8i0cRSO7EOQzck7Y/image.png!thumbnail" alt="图片"><br><img src="https://images-cdn.shimo.im/kg6FIMSZLbMk2GEF/image.png!thumbnail" alt="图片"></p>
<ul>
<li>开始maven打包构建的命令，可以去掉test测试<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clean install -Dmaven.test.skip=true -Ptest</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="https://images-cdn.shimo.im/V86jrVzTrY8SwM4w/image.png!thumbnail" alt="图片"></p>
<h3 id="jenkins与应用服务器同一台机器实现自动部署启动项目"><a href="#jenkins与应用服务器同一台机器实现自动部署启动项目" class="headerlink" title="jenkins与应用服务器同一台机器实现自动部署启动项目"></a>jenkins与应用服务器同一台机器实现自动部署启动项目</h3><ul>
<li>经过上一个步骤之后，jenkins会在默认路径/root/.jenkins/workspace/上看到打包的项目，/root/.jenkins/workspace/homework/target目录下有打包的jar文件。spring-boot-homework-0.0.1-SNAPSHOT.jar。因此我们打包完成之后的工作就是要替换原来的jar文件，然后重启项目。</li>
</ul>
<p><img src="https://images-cdn.shimo.im/ADu38UgvWQkizAeZ/image.png!thumbnail" alt="图片"><br>这里我们使用shell脚本来完成。</p>
<ol>
<li>DIR表示存放jar文件、和启动项目的文件夹。JAEFILE是指jar包的名称。</li>
<li>接下来的工作其实就是杀掉原来的spring-boot-homework-0.0.1-SNAPSHOT.jar进程</li>
<li>备份原来的jar包</li>
<li>把新生成的jar覆盖原来的</li>
<li>然后java -jar启动项目</li>
</ol>
<ul>
<li>BUILD_ID=dontKillMe表示jenkins不杀掉衍生的线程</li>
<li>nohup表示不用提示</li>
</ul>
<p>详细shell脚本如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">echo '~~~~~~~~~开始启动项目~~~~~~~~~'</span><br><span class="line"></span><br><span class="line">DATE=$(date +%Y%m%d_%H%M)</span><br><span class="line">export JAVA_HOME PATH CLASSPATH</span><br><span class="line">JAVA_HOME=/java/jdk1.8.0_181</span><br><span class="line">PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH</span><br><span class="line">CLASSPATH=.:$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$CLASSPATH</span><br><span class="line">DIR=/opt/jar</span><br><span class="line">JARFILE=internetHospital.jar</span><br><span class="line"></span><br><span class="line">if [ ! -d $DIR/backup ];then</span><br><span class="line">   mkdir -p $DIR/backup</span><br><span class="line">fi</span><br><span class="line">cd $DIR</span><br><span class="line"></span><br><span class="line">varpid=`ps aux|grep "internetHospital"|grep -v grep`</span><br><span class="line">if test -z $&#123;varpid&#125;</span><br><span class="line">then</span><br><span class="line">        echo "没有查找到$JARFILE进程"</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">        echo "查找到进程$JARFILE"</span><br><span class="line">        ps -ef | grep $JARFILE | grep -v grep | awk '&#123;print $2&#125;' | xargs kill -9</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line">mv $JARFILE backup/$JARFILE$DATE</span><br><span class="line">mv -f /root/.jenkins/workspace/internethospital/target/$JARFILE .</span><br><span class="line"></span><br><span class="line">BUILD_ID=dontKillMe nohup java -jar $JARFILE &gt; out.log &amp;</span><br><span class="line">if [ $? = 0 ];then</span><br><span class="line">        sleep 30</span><br><span class="line">        tail -n 150 out.log</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">cd backup/</span><br></pre></td></tr></table></figure></p>
<p>ls -lt|awk ‘NR&gt;5{print $NF}’|xargs rm -rf</p>
<p>echo ‘<del>~</del><del>~~结束启动项目</del><del>~</del>~~’</p>
<p>致此，项目就会自动部署，只需要点击构建按钮，jenkins就会自动拉去最新代码，然后备份、重启项目。</p>
<p>代码注释：<br>获得已经在执行程序的pid ，并kill掉<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep <span class="variable">$JARFILE</span> | grep -v grep | awk <span class="string">'&#123;print $2&#125;'</span> | xargs <span class="built_in">kill</span> -9</span><br></pre></td></tr></table></figure></p>
<p>代码流程：</p>
<ol>
<li>先创建存放jar包的目录，如果该目录不存在，然后进入该目录</li>
<li>找出之前已经在运行的jar，并kill掉</li>
<li>把之前的jar包备份</li>
<li>将jenkins最新编译出来的jar包移动到当前目录</li>
<li>启动jar包</li>
</ol>
<h2 id="回顾一下流程："><a href="#回顾一下流程：" class="headerlink" title="回顾一下流程："></a>回顾一下流程：</h2><ul>
<li>首先创建maven项目</li>
<li>配置项目的git仓库地址</li>
<li>配置maven构建命令（打包命令）</li>
<li>打包文成之后执行shell实现切换jar，重新部署项目。</li>
</ul>
<p>### </p>

    </div>
    
    <div class="post-footer">
        <div>
            
            转载声明：
            商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">Snippet</a>
            
            
        </div>
        <div>
            
        </div>
    </div>
</article>
<div class="article-nav prev-next-wrap clearfix">
    
    <a href="/2019/06/02/postgres数据库实践/" class="pre-post btn btn-default" title=''>
        <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
        <span class="hidden-xs">
            </span>
    </a>
    
    
    <a href="/2019/05/27/centos7精简版安装后必须做的事情/" class="next-post btn btn-default" title=''>
        <span class="hidden-lg">下一篇</span>
        <span class="hidden-xs">
            </span><i class="fa fa-angle-right fa-fw"></i>
    </a>
    
</div>

<div id="comments">
    

<div id="vcomments" class="valine"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>
<script>
new Valine({
    av: AV,
    el: '#vcomments',
    appId: 'xOKV9J4UeQAtVkvnJC7Kq2Jn-gzGzoHsz',
    appKey: 'erIpQac4azoCmgfBB7Dl9maa',
    placeholder: '说点什么吧',
    notify: false,
    verify: true,
    avatar: 'mm',
    meta: 'nick,mail'.split(','),
    pageSize: '10',
    path: window.location.pathname,
    lang: ''.toLowerCase()
})
</script>


</div>

                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">
            Table of Contents
        </h3>
        
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是持续集成"><span class="toc-text">什么是持续集成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#总结就是"><span class="toc-text">总结就是</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是jenkins"><span class="toc-text">什么是jenkins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jenkins环境安装"><span class="toc-text">jenkins环境安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#首先安装java环境"><span class="toc-text">首先安装java环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装maven环境"><span class="toc-text">安装maven环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装git环境"><span class="toc-text">安装git环境</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装jenkins"><span class="toc-text">安装jenkins</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#下载jenkins-war"><span class="toc-text">下载jenkins.war</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运行命令"><span class="toc-text">运行命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装过程"><span class="toc-text">安装过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jenkins插件管理"><span class="toc-text">jenkins插件管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jenkins全局配置"><span class="toc-text">jenkins全局配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#构建jar项目"><span class="toc-text">构建jar项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#共同配置"><span class="toc-text">共同配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jenkins与应用服务器同一台机器实现自动部署启动项目"><span class="toc-text">jenkins与应用服务器同一台机器实现自动部署启动项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#回顾一下流程："><span class="toc-text">回顾一下流程：</span></a></li></ol>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2017
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"superSample":2,"width":600,"height":1000,"position":"bottom","hOffset":0,"vOffset":-500},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"tagMode":false});</script></body>
</html>